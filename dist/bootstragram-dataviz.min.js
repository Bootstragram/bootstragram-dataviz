// https://github.com/Bootstragram/bootstragram-dataviz v1.0.0 Copyright 2018 Bootstragram
var D3Common,Scatterplot,version="1.0.0",D3Common$1=D3Common=class{constructor(t){var i,a;"undefined"!=typeof lang&&null!==lang||console.error("lang not set"),this.verbose=!1,this.parentId=t.parentId||"defaultPlotID",this.xVar=t.csvHeaderForX||"x",this.yVar=t.csvHeaderForY||"y",this.xAxisName=null!=(i=this._localizedString(t.xLegend,lang))?i:"x",this.yAxisName=null!=(a=this._localizedString(t.yLegend,lang))?a:"y",this.xAlias=t.xLegendAlias||"x",this.yAlias=t.yLegendAlias||"y",this.margin={top:t.margin&&t.margin.top||5,right:t.margin&&t.margin.right||5,bottom:t.margin&&t.margin.bottom||5,left:t.margin&&t.margin.left||5},this.padding={top:t.padding&&t.padding.top||20,right:t.padding&&t.padding.right||20,bottom:t.padding&&t.padding.bottom||60,left:t.padding&&t.padding.left||60},this.displayRatio=t.displayRatio||1.61803,this.parentSel="#"+this.parentId,this.plotId="svg"+this.parentId,this.plotSel="#"+this.plotId,this.svgWidth=parseInt($(this.parentSel).width())-this.margin.left-this.margin.right,t.forceGraphHeight?this.svgHeight=t.forceGraphHeight+this.padding.top+this.padding.bottom:this.svgHeight=parseInt(this.svgWidth/this.displayRatio)-this.margin.top-this.margin.bottom,this.graphWidth=this.svgWidth-this.padding.left-this.padding.right,this.graphHeight=this.svgHeight-this.padding.top-this.padding.bottom,this.innerPadding={top:.02,right:.02,bottom:.02,left:.02},this.xPaddingLabels=10,this.yPaddingLabels=10,this.xTooltipShift=16,this.yTooltipShift=0,this.tooltipInbound=100,this.xTooltipShiftAlt=-50,this.yTooltipShiftAlt=20,this.tooltipOpacity=.9,this.tooltipTransitionOn=500,this.tooltipTransitionOff=200,this.xTicks=10,this.yTicks=5,this.tickDimension=5,this.tooltip=d3.select(this.parentSel).append("div").attr("class","bsg-d3__tooltip").style("opacity",0),this.xScale=d3.scaleLinear().range([0,this.graphWidth]),this.yScale=d3.scaleLinear().range([this.graphHeight,0])}_drawGrid(){return this.xGrid=d3.axisBottom(this.xScale).ticks(this.xTicks),this.yGrid=d3.axisLeft(this.yScale).ticks(this.yTicks),this.graph.append("g").attr("class","bsg-d3__grid bsg-d3__grid--x").attr("id","x-grid").attr("transform","translate(0,"+this.graphHeight+")").call(this.xGrid.tickSize(-this.graphHeight,0,0).tickPadding(this.xPaddingLabels)),this.graph.append("g").attr("class","bsg-d3__grid bsg-d3__grid--y").attr("id","y-grid").call(this.yGrid.tickSize(-this.graphWidth,0,0).tickPadding(this.yPaddingLabels))}_drawAxis(t=0,i=0){return this.xAxis=d3.axisBottom(this.xScale).ticks(this.xTicks),this.yAxis=d3.axisLeft(this.yScale).ticks(this.yTicks),this.graph.append("g").attr("class","bsg-d3__axis bsg-d3__axis-x").attr("id","x-axis").attr("transform","translate(0,"+this.yScale(t)+")").call(this.xAxis.tickSize(this.tickDimension,0,0).tickFormat("")),this.graph.append("g").attr("class","bsg-d3__axis bsg-d3__axis-y").attr("id","y-axis").attr("transform","translate("+this.xScale(i)+",0)").call(this.yAxis.tickSize(this.tickDimension,0,0).tickFormat(""))}_initSVG(){return this.svg=d3.select(this.parentSel).append("svg").attr("id",this.plotId).attr("width",this.svgWidth).attr("height",this.svgHeight).append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.svg.append("rect").attr("width",this.svgWidth).attr("height",this.svgHeight).attr("class","bsg-d3__background-rect"),this.graph=this.svg.append("g").attr("transform","translate("+this.padding.left+","+this.padding.top+")")}_localizedString(t,i="en"){return null==t?null:"object"==typeof t&&null!=i?t[i]:"string"==typeof t?t:(console.error("Invalid opt: ",t,", lang: ",i),null)}},Scatterplot$1=Scatterplot=class extends D3Common$1{constructor(t,i){super(i),this.csvURL=t,this.verbose=!0,this.showRegressionLine=i.showRegressionLine||!1,this.dataFilteredTooltip=i.dataFilteredTooltip||!1,this.dotRadius=6,this.regLineStrokeWidth=2}_regLine(t,i,a){return t*a+i}_regLineInverse(t,i,a){return 1/t*(a-i)}draw(t=null){var i;return this._initSVG(),i=this,d3.csv(this.csvURL).then(function(a){var e,s,r,n,o,d,h,l,g,p,c,x,m,u,y;if(a.forEach(function(t){return t[i.xVar]=+t[i.xVar],t[i.yVar]=+t[i.yVar]}),d=a.map(function(t){return t[i.xVar]}),x=a.map(function(t){return t[i.yVar]}),g=d3.max(d)-Math.min(0,d3.min(d)),m=d3.max(x)-Math.min(0,d3.min(x)),c=Math.min(0,d3.min(d)-i.innerPadding.left*g),p=Math.max(0,d3.max(d)+i.innerPadding.right*g),y=Math.min(0,d3.min(x)-i.innerPadding.bottom*m),u=Math.max(0,d3.max(x)+i.innerPadding.top*m),i.xScale.domain([c,p]),i.yScale.domain([y,u]),i._drawGrid(),i._drawAxis(),i.svg.append("text").attr("class","bsg-d3__axis-name bsg-d3__axis-name--x").attr("id","x-axis-name").attr("x",(i.svgWidth-i.padding.left-i.padding.right)/2+i.padding.left).attr("y",i.svgHeight).attr("dy","-0.75em").text(i.xAxisName),i.svg.append("text").attr("class","bsg-d3__axis-name bsg-d3__axis-name--y").attr("id","y-axis-name").attr("x",0-(i.svgHeight-i.padding.top-i.padding.bottom)/2-i.padding.top).attr("y",0).attr("dy","1.25em").text(i.yAxisName),(o=i.graph.selectAll("circle").data(d).enter().append("circle").attr("class","bsg-d3__scatter-point").attr("cx",function(t){return i.xScale(t)}).attr("cy",function(t,a){return i.yScale(x[a])}).attr("r",i.dotRadius)).on("mouseover",function(t,e){var s,r;return d3.select(this).attr("class","bsg-d3__scatter-point bsg-d3__scatter-point--highlighted"),i.tooltip.transition().duration(i.tooltipTransitionOn).style("opacity",i.tooltipOpacity),s=a.filter(function(t){return t[i.xVar]===a[e][i.xVar]&&t[i.yVar]===a[e][i.yVar]}),r="<span>"+i.xAlias+" = "+d[e]+", "+i.yAlias+" = "+x[e],i.dataFilteredTooltip&&s.map(function(t,i){return r=r+"<br/> Average rating diff. = "+s[i].Mean+"</span>"}),d3.event.pageX<i.svgWidth-i.tooltipInbound?i.tooltip.html(r).style("left",d3.event.pageX+i.xTooltipShift+"px").style("top",d3.event.pageY+i.yTooltipShift+"px"):i.tooltip.html(r).style("left",d3.event.pageX+i.xTooltipShiftAlt+"px").style("top",d3.event.pageY+i.yTooltipShiftAlt+"px")}),o.on("mouseout",function(t){return d3.select(this).attr("class","bsg-d3__scatter-point"),i.tooltip.transition().duration(i.tooltipTransitionOff).style("opacity",0)}),i.showRegressionLine&&(n=+(s=i._linearRegression(x,d)).slope,r=+s.intercept,l=0,h=0,n<0?(l=Math.max(c,i._regLineInverse(n,r,u)),h=Math.min(p,i._regLineInverse(n,r,y))):(l=Math.max(c,i._regLineInverse(n,r,y)),h=Math.min(p,i._regLineInverse(n,r,u))),i.graph.append("line").attr("id","reg-line").attr("x1",i.xScale(l)).attr("y1",i.yScale(i._regLine(n,r,l))).attr("x2",i.xScale(h)).attr("y2",i.yScale(i._regLine(n,r,h))).attr("class","bsg-d3__line bsg-d3__line--regression").attr("stroke-width",i.regLineStrokeWidth),e=$('<p class="math" id="static-equation">$$P='+n.toFixed(2)+"\\times GD+"+r.toFixed(2)+"$$</p>"),$("#static-equation-container").append(e),"undefined"!=typeof MathJax&&null!==MathJax?MathJax.Hub.Typeset("static-equation"):console.warn("MathJax is not available here")),null!=t)return i.verbose&&console.debug("Calling callback"),t()}).catch(function(t){return console.log(t)}),this}_linearRegression(t,i){var a,e,s,r,n,o,d,h;for(e={},s=t.length,r=0,d=0,o=0,n=0,h=0,a=0;a<t.length;)r+=i[a],d+=t[a],o+=i[a]*t[a],n+=i[a]*i[a],h+=t[a]*t[a],a++;return e.slope=(s*o-r*d)/(s*n-r*r),e.intercept=(d-e.slope*r)/s,e.r2=Math.pow((s*o-r*d)/Math.sqrt((s*n-r*r)*(s*h-d*d)),2),e}drawExtraCurveForDraws(){var t,i,a,e;for(this.verbose&&console.debug("drawExtraCurveForDraws"),a=[],e=[],t=0;t<1370;)a.push(-720+t),e.push(400*Math.pow(10,(-720+t)/200)/Math.pow(1+Math.pow(10,(-720+t)/400),4)),t++;return i=this,this.graph.selectAll("circle").data(a).enter().append("circle").attr("class","bsg-d3__scatter-point bsg-d3__scatter-point--lining").attr("cx",function(t){return i.xScale(t)}).attr("cy",function(t,a){return i.yScale(e[a])}).attr("r",2),this}},index={version:version,D3Common:D3Common,Scatterplot:Scatterplot$1};export default index;
